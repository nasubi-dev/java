# Clipper - 仕様書


## 背景

- MacOS には既存のクリップボードアプリが存在するが、使い勝手や機能面で満足できるものがない
- 開発作業において、頻繁にコピー＆ペーストを行うが、過去のクリップボード履歴にアクセスするのが困難
- テキストの整理や分類機能が不十分

## 目的

Java を使用して、使いやすく機能的なクリップボード管理アプリケーションを自作し、開発効率を向上させる。

## 機能説明

Clipper は、クリップボードの履歴を管理し、ユーザーが過去にコピーしたテキストを簡単に再利用できるようにするアプリケーションです。

### 基本機能

- 自動クリップボード監視: Command + C を検出し、自動的にテキストを Java アプリで保存
- ワンクリック再コピー: 保存済みのテキスト要素をクリックして、再度クリップボードにコピー
- 履歴管理: 不要なテキストエントリの削除機能
- 日別分類: 左サイドバーで日付別にクリップボード履歴を整理

### 追加機能

- 検索機能: 保存されたテキストの全文検索
- お気に入り機能: よく使うテキストをピン留め
- カテゴリ分類: 手動でのタグ付けやカテゴリ分け
- テキストプレビュー: 長いテキストの省略表示と詳細表示切り替え
- エクスポート機能: 履歴を CSV や TXT ファイルで出力
- 設定機能:
  - 履歴保持期間の設定
  - 監視間隔の調整
- 重複検知: 同じテキストの重複保存を防ぐ
- 文字数制限: 極端に長いテキストの自動切り捨て

## 画面構成説明

### メインウィンドウ

- 左サイドバー（20%）: 日付別ナビゲーション
  - 今日、昨日、一昨日...の階層表示
  - 各日付の保存件数表示
- 右メインエリア（80%）: クリップボード履歴表示
  - リスト形式でのテキスト表示
  - タイムスタンプ付きエントリ
  - テキストプレビュー（最初の 2-3 行）
  - 各エントリの操作ボタン（コピー、削除、お気に入り）

### UI コンポーネント

- ツールバー: 検索バー、設定ボタン、クリア機能
- ステータスバー: 現在の監視状態、総保存件数
- コンテキストメニュー: 右クリックでの詳細操作

## データの取り扱い

### データ構造

```java
ClipboardEntry {
    String id;              // 一意識別子
    String text;            // コピーされたテキスト
    LocalDateTime timestamp; // コピー時刻
    String source;          // コピー元アプリ（取得可能な場合）
    boolean isFavorite;     // お気に入りフラグ
    String category;        // カテゴリ（手動設定）
}
```

### データ保存方式

- ファイル形式: CSV 形式でローカルファイルに保存
- 保存場所: `~/Documents/ClipperData/`
- ファイル分割: 日付別にファイルを分割（例：`2025-07-15.csv`）
- データ形式: `id,timestamp,isFavorite,category,text`（テキストは適切にエスケープ）

### データ管理

- 読み込み: アプリ起動時に最新のデータを読み込み
- 保存: 新しいクリップボードエントリが追加されるたびに自動保存
- 削除: ユーザーが不要なエントリを削除可能
- 自動保存: 定期的な自動保存機能

## 技術仕様

### 開発環境

- 言語: Java 21+
- GUI フレームワーク: Java Swing
  - Java 標準の GUI ライブラリを使用してクロスプラットフォーム対応
  - レスポンシブなユーザーインターフェースを実現
- データ処理: Java 標準ライブラリ（CSV）
- ビルドツール: Maven

### プロジェクト構造

```
src/
└── Clipper/
    ├── ClipperApp.java          // メインクラス（アプリケーション起動）
    ├── model/
    │   ├── ClipboardEntry.java  // データモデルクラス
    │   └── ClipboardData.java   // データ管理クラス
    ├── gui/
    │   ├── MainWindow.java      // メインウィンドウ
    │   ├── SideBarPanel.java    // 左サイドバー
    │   ├── HistoryPanel.java    // 履歴表示パネル
    │   └── EntryPanel.java      // 個別エントリ表示
    ├── service/
    │   ├── ClipboardMonitor.java // クリップボード監視
    │   └── FileManager.java     // ファイル読み書き
    └── util/
        ├── DateUtil.java        // 日付ユーティリティ
        └── CsvUtil.java         // CSV処理ユーティリティ
```
### システム要件

- OS: macOS 10.14+
- Java: JRE 17 以上

### セキュリティ考慮事項

- クリップボードアクセス権限の適切な処理

### 実装時の注意点


- すべての GUI 操作は EDT（Event Dispatch Thread）で実行
- SwingUtilities.invokeLater() を適切に使用
- 長時間処理は別スレッドで実行し、結果のみ EDT で更新
- ディレクトリが存在しない場合は自動作成
- CSV の特殊文字（カンマ、改行、ダブルクォート）は適切にエスケープ
- ファイル読み書き時の例外処理を必ず実装
- 大量データ表示時はページネーションまたは仮想化を検討
- 検索時は部分一致でリアルタイムフィルタリング
- ファイル保存は非同期で実行
- クリップボードアクセス失敗時の処理
- ファイル読み書き失敗時の処理
- 不正な CSV データの処理

## 開発スケジュール

### Phase 1: 基本機能実装

Day 1-2: データモデルとファイル管理

- ClipboardEntry.java の実装
- FileManager.java の基本機能（保存・読み込み）
- CSV ファイルフォーマットの確立

Day 3-4: GUI 基本構造

- ClipperApp.java メインクラス
- MainWindow.java 基本レイアウト
- HistoryPanel.java 履歴表示の基本形

Day 5-7: クリップボード監視

- ClipboardMonitor.java 実装
- 監視機能と GUI の連携
- 基本動作テスト

### Phase 2: UI 改善

Day 8-10: サイドバー実装

- SideBarPanel.java 日別分類機能
- 日付選択とフィルタリング機能
- EntryPanel.java エントリ表示改善

Day 11-12: 検索・削除機能

- 検索機能の実装
- エントリ削除機能
- UI 操作性の向上

Day 13-14: バグ修正と調整

- 動作テストとバグ修正
- UI/UX の調整

### Phase 3: 拡張機能

- お気に入り機能
- エクスポート機能
- 設定画面

### 実装チェックリスト

#### 必須機能

- [ ] クリップボード内容の自動検出・保存
- [ ] 保存されたテキストの一覧表示
- [ ] エントリクリックでの再コピー機能
- [ ] 日付別の履歴整理
- [ ] CSV ファイルでのデータ永続化
- [ ] 基本的な検索機能
- [ ] エントリの削除機能
- [ ] お気に入り機能
- [ ] テキストプレビュー表示
- [ ] 重複テキストの検知
- [ ] エクスポート機能
- [ ] 1000x700 のメインウィンドウ
- [ ] 左 20%サイドバー、右 80%メインエリア
- [ ] 検索バー付きツールバー
- [ ] 日付別ナビゲーション
- [ ] エントリごとの操作ボタン

## 制約事項

- Java の制限により、完全なリアルタイム監視は困難（ポーリング方式を採用）
- macOS 特有のセキュリティ制限への対応が必要
- 大量データ保存時のパフォーマンス考慮が必要
